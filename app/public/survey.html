<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <title>Friend Finder</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container mt-5">
        <h1>Survey Questions</h1>
        <hr>
        <h4><b>About You</b></h4>
        <p class="mt-4"><b>Name (Required)</b></p>
        <input type="text" id="name" class="form-control" required>
        <p class="mt-2"><b>Link to Profile Image (Required)</b></p>
        <input type="text" id="picture" class="form-control" required>
        <hr>
        <p class="mt-5"><b>Question 1:</b> You find it difficult to introduce yourself to other people.</p>
        <div class="form-group">
            <select class="form-control" id="question1" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 2:</b> You often get so lost in throughts that you ignore or forget your
            surroundings.</p>
        <div class="form-group">
            <select class="form-control" id="question2" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 3:</b> You try to respond to your e-mails as soon as possible and cannot stand a
            messy inbox.</p>
        <div class="form-group">
            <select class="form-control" id="question3" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 4:</b> You find it easy to stay relaxed even when there is some pressure.</p>
        <div class="form-group">
            <select class="form-control" id="question4" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 5:</b> You do not usually initiate conversations.</p>
        <div class="form-group">
            <select class="form-control" id="question5" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 6:</b> You are usually highly motivated and energetic.</p>
        <div class="form-group">
            <select class="form-control" id="question6" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 7:</b> Winning a debate matters less to you than making sure no one gets upset.</p>
        <div class="form-group">
            <select class="form-control" id="question7" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 8:</b> Your home and work environments are quite tidy.</p>
        <div class="form-group">
            <select class="form-control" id="question8" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 9:</b> You do not usually initiate conversations.</p>
        <div class="form-group">
            <select class="form-control" id="question9" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <p class="mt-1"><b>Question 10:</b> You do not mind being at the center of attention.</p>
        <div class="form-group">
            <select class="form-control" id="question10" style="width: 250px;">
                <option value="1">Strongly Disagree</option>
                <option value="2">Somewhat Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Somewhat Agree</option>
                <option value="5">Strongly Agree</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary btn-lg btn-block mt-5 mb-5" id="submit">Submit</button>
        <hr>
        <p>Note: These questions are originally from a <a
                href="https://www.16personalities.com/free-personality-test">Meyer's Briggs Personality</a> test.
            No copyright infringement was inteded. They are simply being used as a proof-of-concept for the website.
        </p>
        <div class="container mb-5">
            <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/romverner/Friend-Finder">GitHub
                    Repo</a></p>
        </div>
    </div>


    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">You have a match!</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
</body>

</html>

<script type="text/javascript">
    $("#submit").on("click", (event) => {
        event.preventDefault();

        var userAnswerArray = [];

        var newSurveyAnswer = {
            name: $("#name").val().trim(),
            photo: $("#picture").val().trim(),
            answers: [
                $("#question1").val(),
                $("#question2").val(),
                $("#question3").val(),
                $("#question4").val(),
                $("#question5").val(),
                $("#question6").val(),
                $("#question7").val(),
                $("#question8").val(),
                $("#question9").val(),
                $("#question10").val()
            ]
        };

        for (var i = 0; i < newSurveyAnswer.answers.length; i++) {
            userAnswerArray.push(parseInt(newSurveyAnswer.answers[i]));
        };

        console.log(userAnswerArray);

        var differencesArray = [];
        var totalDifference = 0;

        function indexOfSmallest(array) {
            return array.indexOf(Math.min.apply(Math, array));
        };

        $.get("/api/friends", (data) => {
            console.log(data[0]);

            for (var i = 0; i < data.length - 1; i++) {
                for (var j = 0; j < 10; j++) {
                    totalDifference += (Math.abs(userAnswerArray[j] - parseInt(data[i].scores[j])));
                }
                differencesArray.push(totalDifference);
                console.log(differencesArray);
                totalDifference = 0;
            };

            $(".modal-body").html("<h3>" + data[indexOfSmallest(differencesArray)].name + "</h3>");
            $(".modal-body").prepend("<img class='img-fluid' href=" + data[indexOfSmallest(differencesArray)].photo + ">");
            $('#myModal').modal('toggle');
        });

        $.post("/api/tables", newSurveyAnswer, (data) => {

            // Clear fields after answering
            $("#name").val("");
            $("#picture").val("");
            $("#question1").val(1);
            $("#question2").val(1);
            $("#question3").val(1);
            $("#question4").val(1);
            $("#question5").val(1);
            $("#question6").val(1);
            $("#question7").val(1);
            $("#question8").val(1);
            $("#question9").val(1);
            $("#question10").val(1);
            
        });
    });
</script>